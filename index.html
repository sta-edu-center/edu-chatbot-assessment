<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>êµìœ¡ ì´ìˆ˜ í‰ê°€ (ì±—ë´‡í˜•)</title>
  <style>
    body { font-family: system-ui, -apple-system, "Malgun Gothic", sans-serif; margin:0; background:#f5f7fb; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    .card { background:#fff; border-radius:16px; box-shadow: 0 8px 24px rgba(0,0,0,.08); overflow:hidden; }
    .head { padding:16px 18px; border-bottom:1px solid #eef1f6; display:flex; justify-content:space-between; gap:12px; align-items:flex-start; flex-wrap:wrap;}
    .title { font-weight:900; }
    .meta { font-size:12px; color:#6b7280; }
    .badge { font-size:12px; padding:4px 10px; border-radius:999px; background:#eef1f6; color:#111827; }
    .danger { background:#fee2e2; color:#991b1b; }
    .success { background:#dcfce7; color:#166534; }

    .chat { padding:16px 18px; min-height: 360px; background:linear-gradient(#ffffff, #fbfcff); }
    .bubble { max-width: 92%; padding:12px 14px; border-radius:14px; margin:10px 0; line-height:1.45; white-space:pre-wrap; }
    .bot { background:#eef2ff; border-top-left-radius:6px; }
    .user { background:#ecfeff; margin-left:auto; border-top-right-radius:6px; }

    .actions { padding:12px 18px 18px; border-top:1px solid #eef1f6; background:#fff; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input, select { padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; }
    input { flex: 1; min-width: 150px; }
    select { background: #fff; cursor: pointer; }

    .btn { padding:10px 12px; border:0; border-radius:10px; cursor:pointer; font-weight:800; }
    .btn.primary { background:#111827; color:#fff; }
    .btn.ghost { background:#eef1f6; color:#111827; }
    .btn.option { background:#f3f4f6; color:#111827; border:1px solid #e5e7eb; text-align:left; }
    .btn.option:hover { filter: brightness(0.98); }
    .btn.review { background:#2563eb; color:#fff; }
    .btn.review:disabled { opacity:.5; cursor:not-allowed; }

    .options { margin-top: 10px; display:grid; gap:10px; }
    .hint { font-size:12px; color:#6b7280; margin-top:10px; }
    .footer { padding: 12px 18px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; border-top:1px solid #eef1f6; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="head">
      <div>
        <div class="title">Software Testing Foundation Â· êµìœ¡ ì´ìˆ˜ í‰ê°€</div>
        <div class="meta">ê°ê´€ì‹ 10ë¬¸í•­ Â· ìë™ ì±„ì  Â· Pass/Fail Â· ì‘ë‹µ Google Sheets ì €ì¥</div>
      </div>
      <div class="meta">
        <span id="statusBadge" class="badge">ëŒ€ê¸°</span>
      </div>
    </div>

    <div id="chat" class="chat"></div>

    <div class="actions">
      <div class="row">
        <select id="runMonthSelect">
          <option value="">ì‘ì‹œ ì›” ì„ íƒ (í•„ìˆ˜)</option>
        </select>
        <input id="name" placeholder="ì´ë¦„ (í•„ìˆ˜)" />
        <input id="org" placeholder="ì†Œì† (ì„ íƒ)" />
        <button id="startBtn" class="btn primary">ì´ìˆ˜ í‰ê°€ ì‹œì‘</button>
        <button id="resetBtn" class="btn ghost" disabled>ë¦¬ì…‹</button>
        <button id="reviewBtn" class="btn review" disabled>ì •ë‹µ ë¦¬ë·° ë³´ê¸°</button>
      </div>

      <div class="hint">
        Â· ì‘ì‹œ ì›”ì„ ì„ íƒí•˜ê³  ì´ë¦„ì„ ì…ë ¥í•œ ë’¤ ì‹œì‘í•˜ì„¸ìš”.<br/>
        Â· ë³´ê¸° ë²„íŠ¼ì„ í´ë¦­í•´ ë‹µë³€í•˜ì„¸ìš”. (ë§ˆì§€ë§‰ì— ì ìˆ˜ì™€ Pass/Failì´ í‘œì‹œë©ë‹ˆë‹¤)<br/>
        Â· ì¢…ë£Œ í›„ â€œì •ë‹µ ë¦¬ë·° ë³´ê¸°â€ë¥¼ í†µí•´ ìƒì„¸ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>

      <div id="options" class="options"></div>
    </div>

    <div class="footer">
      <div class="meta">ê¸°ì¤€ ì ìˆ˜: <span id="passScoreView">80</span>ì  ì´ìƒ Pass</div>
      <div class="row">
        <label class="meta">Pass ê¸°ì¤€ ì„¤ì •</label>
        <select id="passScore">
          <option value="70">70</option>
          <option value="80" selected>80</option>
          <option value="90">90</option>
        </select>
      </div>
    </div>
  </div>
</div>

<script>
  // =========================
  // âœ… Google Sheets API URL
  // =========================
  const SUBMIT_ENDPOINT = "https://script.google.com/macros/s/AKfycby3Zks4PTgNbFAw1ghS9IqsekBnTbad5dGcJQXiBfvRzI80v1xa5LX-dWp0UCHxYaMd/exec";

  // =========================
  // âœ… ë¬¸ì œ ë°ì´í„°
  // =========================
  const QUESTIONS = [
    { q: "Q1. ë‹¤ìŒ ì¤‘ ì¼ë°˜ì ì¸ í…ŒìŠ¤íŠ¸ ëª©ì ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€?", options: ["a. ê²°í•¨ ì˜ˆë°©","b. ê²°í•¨ ìˆ˜ì •","c. ê²°í•¨ ì œê±°","d. ì¥ì•  ì›ì¸ ë¶„ì„"], answer: 0 },
    { q: "Q2. ì•± ì¶œì‹œ í›„ ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œê²¬ë˜ì—ˆìœ¼ë‚˜ ë™ì¼ í…ŒìŠ¤íŠ¸ë§Œ ë°˜ë³µí•œ ê²½ìš° ë°œìƒí•˜ëŠ” í…ŒìŠ¤íŒ… ì›ë¦¬ëŠ”?", options: ["a. ê²°í•¨-ë¶€ì¬ëŠ” ì˜¤ë¥˜ì´ë‹¤","b. ì™„ë²½í•œ í…ŒìŠ¤íŒ…ì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤","c. í…ŒìŠ¤íŠ¸ íš¨ê³¼ëŠ” ì¤„ì–´ë“ ë‹¤","d. í…ŒìŠ¤íŒ…ì€ ì •í™©ì— ì˜ì¡´ì ì´ë‹¤"], answer: 2 },
    { q: "Q3. ë‹¤ìŒ ì¤‘ ì „ì²´ íŒ€ ì ‘ê·¼ë²•ì— ëŒ€í•œ ì¥ì ìœ¼ë¡œ ì ì ˆí•œ ê²ƒì€?", options: ["a. ê°œë°œ ë¹„ìš©ì´ ì¤„ì–´ë“ ë‹¤","b. íŒ€ ë‚´ ì˜ì‚¬ì†Œí†µê³¼ í˜‘ì—…ì´ ê°•í™”ëœë‹¤","c. ì¶œì‹œ ì¼ì •ì„ ì§€í‚¬ í™•ë¥ ì´ ë†’ì•„ì§„ë‹¤","d. ë…ë¦½ì ì¸ í…ŒìŠ¤í„°ê°€ í•„ìš” ì—†ë‹¤"], answer: 1 },
    { q: "Q4. ë‹¤ìŒ ì¤‘ í–‰ìœ„ì£¼ë„ê°œë°œ(BDD)ì— ëŒ€í•œ ì„¤ëª…ì´ ì•„ë‹Œ ê²ƒì€?", options: ["a. ìì—°ì–´ë¡œ ì‘ì„±í•œë‹¤","b. ì¸ìˆ˜ ì¡°ê±´ì—ì„œ í…ŒìŠ¤íŠ¸ ë„ì¶œí•œë‹¤","c. Given/When/Then í˜•íƒœë‹¤","d. ì˜ì‚¬ ì†Œí†µì„ ì´‰ì§„í•œë‹¤"], answer: 1 },
    { q: "Q5. ì‹œí”„íŠ¸-ë ˆí”„íŠ¸ ì ‘ê·¼ë²•ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì ì ˆí•œ ê²ƒì€?", options: ["a. ê°œë°œ í›„ í…ŒìŠ¤íŒ… ìˆ˜í–‰","b. ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ë§Œ ìˆ˜í–‰","c. ì½”ë“œ ì‘ì„± ì „ í…ŒìŠ¤íŠ¸ ì‘ì„±","d. ë¦¬ë·° ë°°ì œ"], answer: 2 },
    { q: "Q6. ë‹¤ìŒ ì¤‘ ë¶„ê¸° ì»¤ë²„ë¦¬ì§€ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?", options: ["a. ì»¤ë²„ë¦¬ì§€ í•­ëª©ì€ ë¶„ê¸°ë‹¤","b. ì¸¡ì • ìˆ˜ì‹ì´ ì¡´ì¬í•œë‹¤","c. 100% ë¶„ê¸° ì»¤ë²„ë¦¬ì§€ëŠ” êµ¬ë¬¸ ì»¤ë²„ë¦¬ì§€ 100%ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤","d. ëª¨ë“  ê²°í•¨ ë°œê²¬ ë¶ˆê°€"], answer: 2 },
    { q: "Q7. Given/When/Then/And ì¸ìˆ˜ ì¡°ê±´ì€ ì–´ë–¤ í˜•ì‹ì¸ê°€?", options: ["a. ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ì‹¬","b. ê·œì¹™ ì¤‘ì‹¬","c. ì œí’ˆ ì¤‘ì‹¬","d. í”„ë¡œì„¸ìŠ¤ ì¤‘ì‹¬"], answer: 0 },
    { q: "Q8. ë‹¤ìŒ ì¤‘ í…ŒìŠ¤íŒ… ì‹œì‘ ì¡°ê±´ì˜ ì˜ˆë¡œ ì ì ˆí•œ ê²ƒì€?", options: ["a. ë¯¸í•´ê²° ê²°í•¨ ìˆ˜","b. ë¦¬ìŠ¤í¬ ìˆ˜ì¤€","c. ìì›ì˜ ê°€ìš©ì„±","d. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ìœ¨"], answer: 2 },
    { q: "Q9. ë‹¤ìŒ ì¤‘ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ì˜ ì •ì˜ë¡œ ì ì ˆí•œ ê²ƒì€?", options: ["a. ê²°ì œ ì„±ê³µë¥  80% ì´ìƒ","b. êµ¬ë¬¸ ì»¤ë²„ë¦¬ì§€ 100%","c. ì¼ì • ëŒ€ë¹„ ì§„ì²™ìœ¨","d. í…ŒìŠ¤íŠ¸ ë² ì´ì‹œìŠ¤ì˜ ê°€ìš©ì„±"], answer: 3 },
    { q: "Q10. ìë™í™”ì˜ ì ì¬ì  ë¦¬ìŠ¤í¬ ì™„í™” ì¡°ì¹˜ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?", options: ["a. ë¹„í˜„ì‹¤ì  ê¸°ëŒ€ ê²½ê³„","b. ìš´ìš© ìì› ê³ ë ¤","c. ë„êµ¬ì— ì „ì ìœ¼ë¡œ ì˜ì¡´","d. í‘œì¤€ ì¤€ìˆ˜ ì‚¬ì „ í‰ê°€"], answer: 2 },
  ];

  // Refs
  const chat = document.getElementById('chat');
  const optionsBox = document.getElementById('options');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const reviewBtn = document.getElementById('reviewBtn');
  const statusBadge = document.getElementById('statusBadge');
  const passScoreSel = document.getElementById('passScore');
  const passScoreView = document.getElementById('passScoreView');
  const runMonthSelect = document.getElementById('runMonthSelect');

  let idx = -1, score = 0, answers = [];
  let startedAt = null, finishedAt = null;

  // Init: Populate Month Select (Next 12 months)
  function initMonthSelect() {
    const now = new Date();
    for (let i = 0; i < 12; i++) {
      const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
      const val = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
      const opt = document.createElement('option');
      opt.value = val;
      opt.textContent = val;
      runMonthSelect.appendChild(opt);
    }
  }

  function addBubble(text, who="bot") {
    const div = document.createElement('div');
    div.className = `bubble ${who}`;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  function start() {
    const name = document.getElementById('name').value.trim();
    const runMonth = runMonthSelect.value;
    if (!runMonth) { alert("ì‘ì‹œ ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
    if (!name) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

    startedAt = new Date();
    idx = 0; score = 0; answers = [];
    chat.innerHTML = "";
    addBubble(`ì•ˆë…•í•˜ì„¸ìš” ${name}ë‹˜ ğŸ‘‹\n${runMonth} êµìœ¡ ì´ìˆ˜ í‰ê°€ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.`, "bot");
    
    statusBadge.textContent = "ì§„í–‰ì¤‘";
    statusBadge.className = "badge";
    startBtn.disabled = true;
    resetBtn.disabled = false;
    renderQuestion();
  }

  function renderQuestion() {
    const qObj = QUESTIONS[idx];
    addBubble(qObj.q, "bot");
    optionsBox.innerHTML = "";
    qObj.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = "btn option";
      btn.textContent = opt;
      btn.onclick = () => {
        const label = ["a","b","c","d"][i];
        addBubble(`ì„ íƒ: ${label}`, "user");
        if (i === qObj.answer) score += 10;
        answers.push({ qNo: idx+1, selectedIndex: i, selectedLabel: label, correct: (i === qObj.answer) });
        idx++;
        if (idx < QUESTIONS.length) renderQuestion();
        else finish();
      };
      optionsBox.appendChild(btn);
    });
  }

  async function finish() {
    finishedAt = new Date();
    optionsBox.innerHTML = "";
    const passScore = Number(passScoreSel.value);
    const pass = score >= passScore;
    const result = pass ? "PASS" : "FAIL";

    statusBadge.textContent = result;
    statusBadge.className = "badge " + (pass ? "success" : "danger");
    addBubble(`ëª¨ë“  ë¬¸í•­ ì™„ë£Œ!\nì´ì : ${score}ì  / ê²°ê³¼: ${result}`, "bot");
    addBubble("ë°ì´í„° ì €ì¥ ì¤‘...", "bot");

    const payload = {
      runMonth: runMonthSelect.value,
      name: document.getElementById('name').value.trim(),
      org: document.getElementById('org').value.trim(),
      startedAt: startedAt.toISOString(),
      finishedAt: finishedAt.toISOString(),
      score,
      passScore,
      result,
      answers
    };

    const res = await fetch(SUBMIT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    });
    
    addBubble("ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!", "bot");
    reviewBtn.disabled = false;
  }

  reviewBtn.onclick = () => {
    let reviewText = "ğŸ“Œ ì •ë‹µ ë¦¬ë·°\n";
    QUESTIONS.forEach((q, i) => {
      const a = answers[i];
      const ox = a.correct ? "O" : "X";
      reviewText += `Q${i+1}. [${ox}] ì„ íƒ: ${a.selectedLabel} / ì •ë‹µ: ${["a","b","c","d"][q.answer]}\n`;
    });
    addBubble(reviewText, "bot");
  };

  resetBtn.onclick = () => location.reload();
  passScoreSel.onchange = () => passScoreView.textContent = passScoreSel.value;

  initMonthSelect();
  addBubble("ì´ë¦„ê³¼ ì‘ì‹œ ì›”ì„ ì…ë ¥í•˜ê³  ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.", "bot");
</script>
</body>
</html>
