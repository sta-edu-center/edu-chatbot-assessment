<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SW Testing Foundation êµìœ¡ - í›ˆë ¨ìƒ ì´ìˆ˜ í‰ê°€</title>

<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#64748b;
    --line:#e5e7eb;
    --brand:#2563eb;
  }

  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  .container{
    max-width: 980px;
    margin: 28px auto;
    background: var(--card);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    overflow:hidden;
    border:1px solid var(--line);
  }
  .header{
    padding: 16px 20px;
    border-bottom:1px solid var(--line);
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
  }
  .title{ font-weight: 900; font-size: 18px; }
  .sub{ color: var(--muted); font-size: 12px; margin-top: 6px; line-height:1.4; }

  .chat{
    height: 56vh;
    min-height: 420px;
    max-height: 760px;
    overflow-y:auto;
    padding: 18px;
    background: #fafafa;
  }
  .msg{ margin: 10px 0; display:flex; }
  .msg.bot{ justify-content:flex-start; }
  .msg.user{ justify-content:flex-end; }

  .bubble{
    max-width: 78%;
    padding: 12px 14px;
    border-radius: 14px;
    border: 1px solid var(--line);
    background: #f1f5f9;
    white-space: pre-line;
    font-size: 14px;
    line-height: 1.55;
  }
  .msg.user .bubble{
    background: rgba(37,99,235,.12);
    border-color: rgba(37,99,235,.25);
  }

  /* âœ… ê²°ê³¼ ë§í’ì„  */
  .bubble.result{ font-weight: 800; }
  .bubble.result.pass{
    background:#ecfdf5;
    border-color:#22c55e;
    color:#065f46;
  }
  .bubble.result.fail{
    background:#fef2f2;
    border-color:#ef4444;
    color:#7f1d1d;
  }

  .qbtns{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
  .qbtns button{
    padding: 10px 12px;
    border-radius: 12px;
    border:1px solid var(--line);
    background:#fff;
    cursor:pointer;
    font-weight:800;
  }
  .qbtns button:hover{ background:#f8fafc; }
  .qbtns button:disabled{ opacity:.55; cursor:not-allowed; }

  .footer{
    padding: 16px 20px;
    border-top:1px solid var(--line);
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    background:#fff;
  }
  input, select{
    padding: 10px 12px;
    border-radius: 12px;
    border:1px solid var(--line);
    font-size:14px;
    outline:none;
  }
  input:focus, select:focus{
    border-color: rgba(37,99,235,.55);
    box-shadow: 0 0 0 3px rgba(37,99,235,.12);
  }
  button.primary{
    padding: 10px 14px;
    border-radius: 12px;
    border: none;
    background: var(--brand);
    color:#fff;
    font-weight:900;
    cursor:pointer;
  }
  button.primary:disabled{ opacity:.5; cursor:not-allowed; }

  .hint{
    padding: 0 20px 16px 20px;
    color: var(--muted);
    font-size: 12px;
    line-height: 1.45;
  }

  @media (max-width: 820px){
    .bubble{ max-width: 92%; }
    .chat{ height: 62vh; }
    input, select{ flex:1; min-width: 140px; }
  }
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <div>
      <div class="title">Software Testing Foundation Â· í›ˆë ¨ìƒ ì´ìˆ˜ í‰ê°€</div>
      <div class="sub">ê°ê´€ì‹ 10ë¬¸í•­ Â· ìë™ ì±„ì  Â· ê²°ê³¼(PASS/FAIL) ì•ˆë‚´ ë° ì •ë‹µ ë¦¬ë·° Â· Google Sheets ì €ì¥</div>
    </div>
  </div>

  <div id="chat" class="chat"></div>

  <div class="footer">
    <input id="nameInput" placeholder="ì„±í•¨ (í•„ìˆ˜)" />
    <select id="examMonth">
      <option value="">ì‘ì‹œì›” ì„ íƒ</option>
    </select>
    <button id="startBtn" class="primary">í‰ê°€ ì‹œì‘</button>
  </div>

  <div class="hint">
    Â· ì‘ì‹œì›”ì€ í•„ìˆ˜ ì„ íƒì…ë‹ˆë‹¤.<br/>
    Â· ì§„í–‰ ì¤‘ì—ëŠ” ì •ì˜¤ë‹µì„ í‘œì‹œí•˜ì§€ ì•Šìœ¼ë©°, ë§ˆì§€ë§‰ì— ì´ì ê³¼ PASS/FAIL, ì •ë‹µ ë¦¬ë·°ê°€ ì œê³µë©ë‹ˆë‹¤.<br/>
    Â· ì™„ë£Œ í›„ ì‘ë‹µì´ Google Sheetsë¡œ ì €ì¥ë©ë‹ˆë‹¤.
  </div>
</div>

<script>
  // =========================
  // ì œì¶œ ì—”ë“œí¬ì¸íŠ¸ (Google Apps Script)
  // =========================
async function submitToSheets(payload) {
    if (!SUBMIT_ENDPOINT || SUBMIT_ENDPOINT.includes("ì—¬ê¸°ì—_")) {
      addBubble("âš ï¸ ê´€ë¦¬ì ì„¤ì • í•„ìš”: ì‘ë‹µ ì €ì¥ URL(SUBMIT_ENDPOINT)ì´ ì•„ì§ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", "bot");
      return { ok: false, error: "ENDPOINT_NOT_SET" };
    }
    try {
      const res = await fetch(SUBMIT_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });
      const json = await res.json().catch(() => ({}));
      return { ok: res.ok && json.ok === true, ...json };
    } catch (e) {
      return { ok: false, error: String(e) };
    }
  }

  // =========================
  // ë¬¸ì œ/ì •ë‹µ ë°ì´í„° (A set)
  // 1 a, 2 c, 3 b, 4 b, 5 c, 6 c, 7 a, 8 c, 9 d, 10 c
  // answer ì¸ë±ìŠ¤: a=0, b=1, c=2, d=3
  // =========================
  const QUESTIONS = [
    { q: "Q1. ë‹¤ìŒ ì¤‘ ì¼ë°˜ì ì¸ í…ŒìŠ¤íŠ¸ ëª©ì ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€?",
      options: ["a. ê²°í•¨ ì˜ˆë°©","b. ê²°í•¨ ìˆ˜ì •","c. ê²°í•¨ ì œê±°","d. ì¥ì•  ì›ì¸ ë¶„ì„"], answer: 0 },
    { q: "Q2. íšŒì‚¬ëŠ” ì¼ì • ê´€ë¦¬ ì•±ì„ ê°œë°œí•˜ê³  ìˆë‹¤. ê°œë°œíŒ€ì€ ì•±ì˜ í•µì‹¬ ê¸°ëŠ¥ì¸ ì¼ì • ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ ê¸°ëŠ¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ìˆ˜í–‰í–ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©í–ˆê³ , ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ì§€ ì•Šì•˜ë‹¤. ì•± ì¶œì‹œ í›„ ì‚¬ìš©ìê°€ ì¼ì •ì„ ì—¬ëŸ¬ ê°œ ë“±ë¡í•  ê²½ìš° ì•±ì´ ì¢…ë£Œë˜ëŠ” ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œê²¬ë˜ì—ˆë‹¤.\n\në‹¤ìŒ ì¤‘ ì´ ìƒí™©ì„ ì„¤ëª…í•´ì£¼ëŠ” í…ŒìŠ¤íŒ… ì›ë¦¬ëŠ”?",
      options: ["a. ê²°í•¨-ë¶€ì¬ëŠ” ì˜¤ë¥˜ì´ë‹¤","b. ì™„ë²½í•œ í…ŒìŠ¤íŒ…ì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤","c. í…ŒìŠ¤íŠ¸ íš¨ê³¼ëŠ” ì¤„ì–´ë“ ë‹¤","d. í…ŒìŠ¤íŒ…ì€ ì •í™©ì— ì˜ì¡´ì ì´ë‹¤"], answer: 2 },
    { q: "Q3. ë‹¤ìŒ ì¤‘ ì „ì²´ íŒ€ ì ‘ê·¼ë²•ì— ëŒ€í•œ ì¥ì ìœ¼ë¡œ ì ì ˆí•œ ê²ƒì€?",
      options: ["a. ê°œë°œ ë¹„ìš©ì´ ì¤„ì–´ë“ ë‹¤","b. íŒ€ ë‚´ ì˜ì‚¬ì†Œí†µê³¼ í˜‘ì—…ì´ ê°•í™”ëœë‹¤","c. ì¶œì‹œ ì¼ì •ì„ ì§€í‚¬ í™•ë¥ ì´ ë†’ì•„ì§„ë‹¤","d. ë…ë¦½ì ì¸ í…ŒìŠ¤í„°ê°€ í•„ìš” ì—†ë‹¤"], answer: 1 },
    { q: "Q4. ë‹¤ìŒ ì¤‘ í–‰ìœ„ì£¼ë„ê°œë°œ(BDD)ì— ëŒ€í•œ ì„¤ëª…ì´ ì•„ë‹Œ ê²ƒì€?",
      options: [
        "a. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ëŒ€ ë™ì‘ì„ ê¸°ìˆ ì  ë°°ê²½ì´ ì ì€ ì´í•´ê´€ê³„ìë“¤ë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ìì—°ì–´ë¡œ ì‘ì„±í•œë‹¤.",
        "b. ì‚¬ìš©ì ìŠ¤í† ë¦¬ì˜ ì¸ìˆ˜ ì¡°ê±´ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë„ì¶œí•˜ì—¬ ìˆ˜í–‰í•œë‹¤.",
        "c. ìì—°ì–´ ìš”êµ¬ì‚¬í•­ì€ ì¼ë°˜ì ìœ¼ë¡œ Given/When/Then ì˜ í˜•íƒœë¡œ ì‘ì„±í•œë‹¤.",
        "d. BDD ë°©ì‹ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ì‚¬ìš©ì, ê°œë°œì ë° í…ŒìŠ¤í„° ê°„ì˜ ì˜ì‚¬ ì†Œí†µì„ ì´‰ì§„í•œë‹¤."
      ], answer: 1 },
    { q: "Q5. ì‹œí”„íŠ¸-ë ˆí”„íŠ¸ ì ‘ê·¼ë²•ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì ì ˆí•œ ê²ƒì€?",
      options: [
        "a. í…ŒìŠ¤íŒ…ì€ ì œí’ˆ ê°œë°œì´ ëë‚œ í›„ì— ìˆ˜í–‰í•œë‹¤.",
        "b. ë¹„ê¸°ëŠ¥ í…ŒìŠ¤íŒ…ì€ ì‹œìŠ¤í…œ ë ˆë²¨ ë˜ëŠ” ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ ë ˆë²¨ì—ì„œ ìˆ˜í–‰í•œë‹¤.",
        "c. ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ì „ì— í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.",
        "d. ë¦¬ë·°ì— í…ŒìŠ¤í„°ê°€ ì°¸ì—¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤."
      ], answer: 2 },
    { q: "Q6. ë‹¤ìŒ ì¤‘ ë¶„ê¸° ì»¤ë²„ë¦¬ì§€ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?",
      options: [
        "a. ë¶„ê¸° í…ŒìŠ¤íŒ…ì˜ ì»¤ë²„ë¦¬ì§€ í•­ëª©ì€ ë¶„ê¸°ì´ë‹¤.",
        "b. ì»¤ë²„ë¦¬ì§€ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì‹¤í–‰í•œ ë¶„ê¸° ìˆ˜ë¥¼ ë¶„ê¸°ì˜ ì´ìˆ˜ë¡œ ë‚˜ëˆˆ ê°’ìœ¼ë¡œ ì¸¡ì •í•œë‹¤.",
        "c. 100% ë¶„ê¸° ì»¤ë²„ë¦¬ì§€ë¥¼ ë‹¬ì„±í•˜ë”ë¼ë„ êµ¬ë¬¸ ì»¤ë²„ë¦¬ì§€ëŠ” 100%ê°€ ì•„ë‹ ìˆ˜ë„ ìˆë‹¤.",
        "d. ë¶„ê¸° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ìœ¼ë¡œ ëª¨ë“  ê²°í•¨ì„ ë‹¤ ì°¾ì„ ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤."
      ], answer: 2 },
    { q: "Q7. Given/When/Then/And ì¸ìˆ˜ ì¡°ê±´ì€ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ì‘ì„±ëœ ê²ƒì¸ê°€?",
      options: ["a. ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ì‹¬","b. ê·œì¹™ ì¤‘ì‹¬","c. ì œí’ˆ ì¤‘ì‹¬","d. í”„ë¡œì„¸ìŠ¤ ì¤‘ì‹¬"], answer: 0 },
    { q: "Q8. ë‹¤ìŒ ì¤‘ í…ŒìŠ¤íŒ… ì‹œì‘ ì¡°ê±´ì˜ ì˜ˆë¡œ ì ì ˆí•œ ê²ƒì€?",
      options: ["a. í•´ê²°ë˜ì§€ ì•Šì€ ê²°í•¨ ìˆ˜","b. ë¦¬ìŠ¤í¬ ì»¤ë²„ë¦¬ì§€ ìˆ˜ì¤€","c. ì¸ë ¥, ë„êµ¬, í…ŒìŠ¤íŠ¸ ë°ì´í„° ë“± ìì›ì˜ ê°€ìš©ì„±","d. ê³„íší•œ í…ŒìŠ¤íŠ¸ì˜ ì‹¤í–‰ìœ¨"], answer: 2 },
    { q: "Q9. ë‹¤ìŒ ì¤‘ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ì˜ ì •ì˜ë¡œ ì ì ˆí•œ ê²ƒì€?",
      options: ["a. ì‚¬ìš©ìì˜ ê²°ì œ ì‘ì—… ì„±ê³µë¥ ì€ 80% ì´ìƒì´ ë˜ì–´ì•¼ í•œë‹¤.","b. êµ¬ë¬¸ ì»¤ë²„ë¦¬ì§€ 100%","c. ê³„íšëœ ì¼ì • ëŒ€ë¹„ ì§„ì²™ìœ¨","d. í…ŒìŠ¤íŠ¸ ëª¨ë¸ì„ ì‘ì„±í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ ë² ì´ì‹œìŠ¤ì˜ ê°€ìš©ì„±"], answer: 3 },
    { q: "Q10. ìë™í™”ì˜ ì ì¬ì  ë¦¬ìŠ¤í¬ì— ëŒ€í•œ ë¦¬ìŠ¤í¬ ì™„í™” ì¡°ì¹˜ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?",
      options: ["a. ë„êµ¬ì˜ íš¨ê³¼ì— ëŒ€í•œ ë¹„í˜„ì‹¤ì ì¸ ê¸°ëŒ€ë¥¼ ê²½ê³„í•œë‹¤.","b. ë„êµ¬ ë„ì…, ìš´ìš©ì— ëŒ€í•œ ìì›ì„ ì¶©ë¶„íˆ ê³ ë ¤í•œë‹¤.","c. ê°œì„ í•´ì•¼ í•  ì‘ì—…ì— ë„ì…ë˜ëŠ” ë„êµ¬ì— ì „ì ìœ¼ë¡œ ì˜ì¡´í•œë‹¤.","d. ê·œì œ ìš”ê±´ì´ë‚˜ ì•ˆì „ í‘œì¤€ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ ë„êµ¬ë¥¼ ì‚¬ì „ì— í‰ê°€í•œë‹¤."], answer: 2 },
  ];


  const PASS_SCORE = 80;   // 80ì  ì´ìƒ Pass
  const POINT_PER_Q = 10;  // 10ë¬¸í•­ -> 100ì 

  let current = -1;
  let score = 0;
  let answers = []; // {qno, selectedIdx, correctIdx}
  let submitInFlight = false;

  const chat = document.getElementById("chat");
  const startBtn = document.getElementById("startBtn");
  const nameInput = document.getElementById("nameInput");
  const examMonthSelect = document.getElementById("examMonth");

  function addBubble(text, role = "bot") {
    const msg = document.createElement("div");
    msg.className = "msg " + role;

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerText = text;

    msg.appendChild(bubble);
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;

    return bubble;
  }

  function addQuestionBubble(qObj) {
    const msg = document.createElement("div");
    msg.className = "msg bot";

    const bubble = document.createElement("div");
    bubble.className = "bubble";

    const title = document.createElement("div");
    title.style.fontWeight = "900";
    title.style.marginBottom = "8px";
    title.innerText = `Q${qObj.no}. ${qObj.q}`;
    bubble.appendChild(title);

    const btns = document.createElement("div");
    btns.className = "qbtns";

    qObj.options.forEach((opt, idx) => {
      const b = document.createElement("button");
      b.type = "button";
      b.innerText = opt;
      b.addEventListener("click", () => chooseAnswer(idx, btns));
      btns.appendChild(b);
    });

    bubble.appendChild(btns);
    msg.appendChild(bubble);
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;
  }

  function disableButtons(btnContainer) {
    btnContainer.querySelectorAll("button").forEach(b => b.disabled = true);
  }

  function idxToLetter(i){
    return ["a","b","c","d"][i] || "";
  }

  // ===== ì‘ì‹œì›” ë“œë¡­ë‹¤ìš´ (ì´ë²ˆë‹¬ ~ +11ê°œì›”) =====
  (function populateMonths(){
    const now = new Date();
    for (let i=0; i<12; i++){
      const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const value = `${y}-${m}`;
      const opt = document.createElement("option");
      opt.value = value;
      opt.textContent = value;
      examMonthSelect.appendChild(opt);
    }
  })();

  function start() {
    if (submitInFlight) return;

    const name = nameInput.value.trim();
    const examMonth = examMonthSelect.value;

    if (!name) { alert("ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); nameInput.focus(); return; }
    if (!examMonth) { alert("ì‘ì‹œì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); examMonthSelect.focus(); return; }

    current = -1;
    score = 0;
    answers = [];

    nameInput.disabled = true;
    examMonthSelect.disabled = true;
    startBtn.disabled = true;

    addBubble(`ì•ˆë…•í•˜ì„¸ìš” ${name}ë‹˜ ğŸ˜Š\nì‘ì‹œì›”: ${examMonth}\ní‰ê°€ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. (ì´ ${QUESTIONS.length}ë¬¸í•­)`, "bot");
    nextQuestion();
  }

  function nextQuestion(){
    current++;
    if (current >= QUESTIONS.length){
      finish();
      return;
    }
    addQuestionBubble(QUESTIONS[current]);
  }

  function chooseAnswer(selectedIdx, btnContainer){
    disableButtons(btnContainer);

    const qObj = QUESTIONS[current];
    answers.push({ qno: qObj.no, selectedIdx, correctIdx: qObj.answerIdx });

    addBubble(`ì„ íƒ: ${qObj.options[selectedIdx]}`, "user");

    if (selectedIdx === qObj.answerIdx) score += POINT_PER_Q;

    setTimeout(nextQuestion, 200);
  }

  async function submitToSheet(payload){
    // Google Apps Script Web App í™˜ê²½ì— ë”°ë¼ CORS/ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆì–´
    // 1) JSON POST ì‹œë„ â†’ ì‹¤íŒ¨ ì‹œ 2) x-www-form-urlencodedë¡œ ì¬ì‹œë„
    const ac1 = new AbortController();
    const t1 = setTimeout(() => ac1.abort(), 12000);

    try{
      const res = await fetch(SUBMIT_ENDPOINT, {
        method: "POST",
        mode: "cors",
        redirect: "follow",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        signal: ac1.signal
      });
      clearTimeout(t1);
      return res;
    }catch(e){
      clearTimeout(t1);

      const form = new URLSearchParams();
      for (const [k,v] of Object.entries(payload)){
        form.append(k, typeof v === "string" ? v : JSON.stringify(v));
      }

      const ac2 = new AbortController();
      const t2 = setTimeout(() => ac2.abort(), 12000);

      try{
        const res2 = await fetch(SUBMIT_ENDPOINT, {
          method: "POST",
          mode: "cors",
          redirect: "follow",
          headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
          body: form.toString(),
          signal: ac2.signal
        });
        clearTimeout(t2);
        return res2;
      }catch(e2){
        clearTimeout(t2);
        throw e2;
      }
    }
  }

  async function finish(){
    const name = nameInput.value.trim();
    const examMonth = examMonthSelect.value;

    const pass = score >= PASS_SCORE;
    const resultLabel = pass ? "PASS" : "FAIL";

    addBubble("ëª¨ë“  ë¬¸í•­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ âœ…", "bot");

    const resultBubble = addBubble(
      `ì´ë¦„: ${name}\nì‘ì‹œì›”: ${examMonth}\nì´ì : ${score}ì \nê²°ê³¼: ${resultLabel}\n(ê¸°ì¤€: ${PASS_SCORE}ì  ì´ìƒ Pass)`,
      "bot"
    );
    resultBubble.classList.add("result", pass ? "pass" : "fail");

    // ===== ì œì¶œ payload =====
    const submittedAt = new Date().toISOString();
    const payload = {
      name,
      examMonth,
      score,
      passScore: PASS_SCORE,
      result: resultLabel,
      submittedAt,
      answers // ìƒì„¸ JSON
    };

    addBubble("ì‘ë‹µì„ ì €ì¥ ì¤‘ì…ë‹ˆë‹¤â€¦", "bot");

    submitInFlight = true;
    try{
      const res = await submitToSheet(payload);
      if (!res || !res.ok){
        addBubble("âš ï¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (Apps Script ë°°í¬/ê¶Œí•œ/CORS ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”)", "bot");
      }else{
        addBubble("âœ… ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "bot");
      }
    }catch(e){
      addBubble("âš ï¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” Apps Script ì„¤ì • í™•ì¸)", "bot");
    }finally{
      submitInFlight = false;
    }

    addBubble("ì •ë‹µ ë¦¬ë·°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.", "bot");

    QUESTIONS.forEach((q, i) => {
      const userSel = answers[i]?.selectedIdx;
      const userText = (userSel === undefined) ? "-" : q.options[userSel];
      const correctText = q.options[q.answerIdx];
      const ok = userSel === q.answerIdx;

      addBubble(
        `Q${q.no}. ${q.q}\n` +
        `- ë‚´ ë‹µ: ${userText} (${userSel === undefined ? "-" : idxToLetter(userSel)})\n` +
        `- ì •ë‹µ: ${correctText} (${idxToLetter(q.answerIdx)})\n` +
        `- ê²°ê³¼: ${ok ? "O" : "X"}`,
        "bot"
      );
    });

    addBubble("ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‘", "bot");
  }

  addBubble("ì•ˆë…•í•˜ì„¸ìš”! ì„±í•¨ê³¼ ì‘ì‹œì›”ì„ ì…ë ¥/ì„ íƒ í›„ [í‰ê°€ ì‹œì‘]ì„ ëˆŒëŸ¬ì£¼ì„¸ìš” ğŸ˜Š", "bot");
  startBtn.addEventListener("click", start);
</script>
</body>
</html>
