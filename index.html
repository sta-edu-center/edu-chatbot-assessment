<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SW Testing Foundation 교육 이수자 평가</title>
  <style>
    body { font-family: system-ui, -apple-system, "Malgun Gothic", sans-serif; margin:0; background:#f5f7fb; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 18px; }
    .card { background:#fff; border-radius:16px; box-shadow: 0 8px 24px rgba(0,0,0,.08); overflow:hidden; }

    .head { padding:16px 18px; border-bottom:1px solid #eef1f6; }
    .title { font-weight:900; }
    .meta { font-size:12px; color:#6b7280; margin-top:4px; }

    .chat { padding:16px 18px; min-height: 320px; background:linear-gradient(#ffffff, #fbfcff); }
    .bubble { max-width: 92%; padding:12px 14px; border-radius:14px; margin:10px 0; line-height:1.45; white-space:pre-wrap; }
    .bot { background:#eef2ff; border-top-left-radius:6px; }
    .user { background:#ecfeff; margin-left:auto; border-top-right-radius:6px; }

    /* 결과 색상 */
    .result-pass { background:#dcfce7; color:#14532d; border-top-left-radius:6px; }
    .result-fail { background:#fee2e2; color:#7f1d1d; border-top-left-radius:6px; }

    /* 운영월 배너 */
    .banner {
      max-width: 92%;
      padding: 16px 18px;
      border-radius: 16px;
      margin: 12px 0;
      background: #111827;
      color: #fff;
      font-weight: 900;
      font-size: 18px;
    }
    .banner .sub { font-size:12px; opacity:.9; margin-top:6px; }

    .actions { padding:12px 18px 18px; border-top:1px solid #eef1f6; background:#fff; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input, select { padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; }
    input { flex: 1; min-width: 180px; }

    .btn { padding:10px 14px; border:0; border-radius:10px; cursor:pointer; font-weight:800; }
    .btn.primary { background:#111827; color:#fff; }
    .btn.option { background:#f3f4f6; border:1px solid #e5e7eb; text-align:left; }

    .options { margin-top: 10px; display:grid; gap:10px; }
    .hint { font-size:12px; color:#6b7280; margin-top:10px; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="head">
      <div class="title">교육 이수 평가</div>
      <div class="meta">객관식 10문항 · 자동 채점 · Pass / Fail</div>
    </div>

    <div id="chat" class="chat"></div>

    <div class="actions">
      <div class="row">
        <input id="name" placeholder="이름 (필수)" />
        <select id="monthSelect">
          <option value="">응시 월 선택</option>
        </select>
        <button id="startBtn" class="btn primary">이수 평가 시작</button>
      </div>

      <div id="options" class="options"></div>

      <div class="hint">
        · 응시 월을 선택한 후 평가를 시작하세요.<br/>
        · 모든 응답은 자동으로 저장됩니다.
      </div>
    </div>
  </div>
</div>

<script>
  /* =========================
     설정
  ========================= */
  const SUBMIT_ENDPOINT = "여기에_AppsScript_웹앱_URL";

  /* =========================
     문제 / 정답
     a=0, b=1, c=2, d=3
  ========================= */
  const QUESTIONS = [
    { q:"Q1. 일반적인 테스트 목적은?", o:["a. 결함 예방","b. 결함 수정","c. 결함 제거","d. 장애 원인 분석"], a:0 },
    { q:"Q2. 반복 테스트로 신규 결함을 못 찾은 원리는?", o:["a","b","c","d"], a:2 },
    { q:"Q3. 전체 팀 접근법의 장점은?", o:["a","b","c","d"], a:1 },
    { q:"Q4. BDD 설명이 아닌 것은?", o:["a","b","c","d"], a:1 },
    { q:"Q5. 시프트-레프트 설명은?", o:["a","b","c","d"], a:2 },
    { q:"Q6. 분기 커버리지 설명 중 틀린 것은?", o:["a","b","c","d"], a:2 },
    { q:"Q7. Given/When/Then 형식은?", o:["a","b","c","d"], a:0 },
    { q:"Q8. 테스팅 시작 조건 예는?", o:["a","b","c","d"], a:2 },
    { q:"Q9. 테스트 준비 정의는?", o:["a","b","c","d"], a:3 },
    { q:"Q10. 자동화 리스크 완화로 부적절한 것은?", o:["a","b","c","d"], a:2 },
  ];

  const chat = document.getElementById("chat");
  const optionsBox = document.getElementById("options");
  const startBtn = document.getElementById("startBtn");
  const monthSelect = document.getElementById("monthSelect");

  let idx = -1, score = 0, answers = [], startedAt;

  function addBubble(text, cls="bot") {
    const d = document.createElement("div");
    d.className = "bubble " + cls;
    d.textContent = text;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
  }

  function addBanner(month) {
    const d = document.createElement("div");
    d.className = "banner";
    d.innerHTML = `응시 월: ${month}<div class="sub">선택한 응시 월을 확인하세요</div>`;
    chat.appendChild(d);
  }

  function buildMonths() {
    const now = new Date();
    for (let i=0;i<12;i++) {
      const d = new Date(now.getFullYear(), now.getMonth()+i, 1);
      const v = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
      const o = document.createElement("option");
      o.value = v; o.textContent = v;
      monthSelect.appendChild(o);
    }
  }

  function showQ() {
    const q = QUESTIONS[idx];
    addBubble(q.q,"bot");
    optionsBox.innerHTML="";
    q.o.forEach((t,i)=>{
      const b=document.createElement("button");
      b.className="btn option";
      b.textContent=t;
      b.onclick=()=>choose(i);
      optionsBox.appendChild(b);
    });
  }

  function choose(i) {
    const q = QUESTIONS[idx];
    addBubble(`선택: ${["a","b","c","d"][i]}`,"user");
    if (i===q.a) score+=10;
    answers.push({q:idx+1, pick:i, correct:i===q.a});
    idx++;
    optionsBox.innerHTML="";
    if (idx<QUESTIONS.length) showQ();
    else finish();
  }

  async function finish() {
    const pass = score>=80;
    addBubble(
      `총점: ${score}점\n결과: ${pass?"PASS":"FAIL"}`,
      pass?"result-pass":"result-fail"
    );

    fetch(SUBMIT_ENDPOINT,{
      method:"POST",
      headers:{"Content-Type":"text/plain;charset=utf-8"},
      body:JSON.stringify({
        name:document.getElementById("name").value,
        runMonth:monthSelect.value,
        score, result:pass?"PASS":"FAIL",
        answers, startedAt
      })
    });
  }

  startBtn.onclick=()=>{
    if(!document.getElementById("name").value) return alert("이름을 입력하세요");
    if(!monthSelect.value) return alert("응시 월을 선택하세요");
    chat.innerHTML="";
    idx=0; score=0; answers=[];
    startedAt=new Date().toISOString();
    addBubble("이수 평가를 시작합니다.","bot");
    addBanner(monthSelect.value);
    showQ();
  };

  buildMonths();
</script>
</body>
</html>
